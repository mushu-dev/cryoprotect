(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[888],{3454:function(e,t,r){"use strict";var n,i;e.exports=(null==(n=r.g.process)?void 0:n.env)&&"object"==typeof(null==(i=r.g.process)?void 0:i.env)?r.g.process:r(7663)},1118:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/_app",function(){return r(3589)}])},3589:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return _app}});var n=r(5893),i=r(7294);r(415);var s=r(3481),o=r(3430);function ConvexClientProvider(e){let{children:t}=e;return(0,i.useState)(()=>{o.i.setAuth({type:"anonymous"})},[]),(0,n.jsx)(s.P9,{client:o.i,children:t})}var a=r(3454);let u="true"===a.env.NEXT_PUBLIC_USE_CONVEX;var _app=function(e){let{Component:t,pageProps:r}=e;return u?(0,n.jsx)(ConvexClientProvider,{children:(0,n.jsx)(t,{...r})}):(0,n.jsx)(t,{...r})}},3430:function(e,t,r){"use strict";r.d(t,{i:function(){return s}});var n=r(3481),i=r(3454);let s=new n.Zj(i.env.NEXT_PUBLIC_CONVEX_URL||"https://primary-meerkat-478.convex.cloud")},415:function(){},7663:function(e){!function(){var t={229:function(e){var t,r,n,i=e.exports={};function defaultSetTimout(){throw Error("setTimeout has not been defined")}function defaultClearTimeout(){throw Error("clearTimeout has not been defined")}function runTimeout(e){if(t===setTimeout)return setTimeout(e,0);if((t===defaultSetTimout||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(r){try{return t.call(null,e,0)}catch(r){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(e){t=defaultSetTimout}try{r="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(e){r=defaultClearTimeout}}();var s=[],o=!1,a=-1;function cleanUpNextTick(){o&&n&&(o=!1,n.length?s=n.concat(s):a=-1,s.length&&drainQueue())}function drainQueue(){if(!o){var e=runTimeout(cleanUpNextTick);o=!0;for(var t=s.length;t;){for(n=s,s=[];++a<t;)n&&n[a].run();a=-1,t=s.length}n=null,o=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===defaultClearTimeout||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function Item(e,t){this.fun=e,this.array=t}function noop(){}i.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];s.push(new Item(e,t)),1!==s.length||o||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=noop,i.addListener=noop,i.once=noop,i.off=noop,i.removeListener=noop,i.removeAllListeners=noop,i.emit=noop,i.prependListener=noop,i.prependOnceListener=noop,i.listeners=function(e){return[]},i.binding=function(e){throw Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw Error("process.chdir is not supported")},i.umask=function(){return 0}}},r={};function __nccwpck_require__(e){var n=r[e];if(void 0!==n)return n.exports;var i=r[e]={exports:{}},s=!0;try{t[e](i,i.exports,__nccwpck_require__),s=!1}finally{s&&delete r[e]}return i.exports}__nccwpck_require__.ab="//";var n=__nccwpck_require__(229);e.exports=n}()},7983:function(e,t,r){"use strict";var n=r(3454),i=Symbol.for("react.transitional.element"),s=Symbol.for("react.portal"),o=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),u=Symbol.for("react.profiler"),c=Symbol.for("react.consumer"),l=Symbol.for("react.context"),h=Symbol.for("react.forward_ref"),d=Symbol.for("react.suspense"),f=Symbol.for("react.memo"),g=Symbol.for("react.lazy"),p=Symbol.iterator,y={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,b={};function Component(e,t,r){this.props=e,this.context=t,this.refs=b,this.updater=r||y}function ComponentDummy(){}function PureComponent(e,t,r){this.props=e,this.context=t,this.refs=b,this.updater=r||y}Component.prototype.isReactComponent={},Component.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},Component.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},ComponentDummy.prototype=Component.prototype;var v=PureComponent.prototype=new ComponentDummy;v.constructor=PureComponent,m(v,Component.prototype),v.isPureReactComponent=!0;var _=Array.isArray,w={H:null,A:null,T:null,S:null,V:null},S=Object.prototype.hasOwnProperty;function ReactElement(e,t,r,n,s,o){return{$$typeof:i,type:e,key:t,ref:void 0!==(r=o.ref)?r:null,props:o}}function isValidElement(e){return"object"==typeof e&&null!==e&&e.$$typeof===i}var k=/\/+/g;function getElementKey(e,t){var r,n;return"object"==typeof e&&null!==e&&null!=e.key?(r=""+e.key,n={"=":"=0",":":"=2"},"$"+r.replace(/[=:]/g,function(e){return n[e]})):t.toString(36)}function noop$1(){}function mapChildren(e,t,r){if(null==e)return e;var n=[],o=0;return!function mapIntoArray(e,t,r,n,o){var a,u,c,l=typeof e;("undefined"===l||"boolean"===l)&&(e=null);var h=!1;if(null===e)h=!0;else switch(l){case"bigint":case"string":case"number":h=!0;break;case"object":switch(e.$$typeof){case i:case s:h=!0;break;case g:return mapIntoArray((h=e._init)(e._payload),t,r,n,o)}}if(h)return o=o(e),h=""===n?"."+getElementKey(e,0):n,_(o)?(r="",null!=h&&(r=h.replace(k,"$&/")+"/"),mapIntoArray(o,t,r,"",function(e){return e})):null!=o&&(isValidElement(o)&&(a=o,u=r+(null==o.key||e&&e.key===o.key?"":(""+o.key).replace(k,"$&/")+"/")+h,o=ReactElement(a.type,u,void 0,void 0,void 0,a.props)),t.push(o)),1;h=0;var d=""===n?".":n+":";if(_(e))for(var f=0;f<e.length;f++)l=d+getElementKey(n=e[f],f),h+=mapIntoArray(n,t,r,l,o);else if("function"==typeof(f=null===(c=e)||"object"!=typeof c?null:"function"==typeof(c=p&&c[p]||c["@@iterator"])?c:null))for(e=f.call(e),f=0;!(n=e.next()).done;)l=d+getElementKey(n=n.value,f++),h+=mapIntoArray(n,t,r,l,o);else if("object"===l){if("function"==typeof e.then)return mapIntoArray(function(e){switch(e.status){case"fulfilled":return e.value;case"rejected":throw e.reason;default:switch("string"==typeof e.status?e.then(noop$1,noop$1):(e.status="pending",e.then(function(t){"pending"===e.status&&(e.status="fulfilled",e.value=t)},function(t){"pending"===e.status&&(e.status="rejected",e.reason=t)})),e.status){case"fulfilled":return e.value;case"rejected":throw e.reason}}throw e}(e),t,r,n,o);throw Error("Objects are not valid as a React child (found: "+("[object Object]"===(t=String(e))?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.")}return h}(e,n,"","",function(e){return t.call(r,e,o++)}),n}function lazyInitializer(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){(0===e._status||-1===e._status)&&(e._status=1,e._result=t)},function(t){(0===e._status||-1===e._status)&&(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var A="function"==typeof reportError?reportError:function(e){if("object"==typeof window&&"function"==typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"==typeof e&&null!==e&&"string"==typeof e.message?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if("object"==typeof n&&"function"==typeof n.emit){n.emit("uncaughtException",e);return}console.error(e)};function noop(){}t.Children={map:mapChildren,forEach:function(e,t,r){mapChildren(e,function(){t.apply(this,arguments)},r)},count:function(e){var t=0;return mapChildren(e,function(){t++}),t},toArray:function(e){return mapChildren(e,function(e){return e})||[]},only:function(e){if(!isValidElement(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=Component,t.Fragment=o,t.Profiler=u,t.PureComponent=PureComponent,t.StrictMode=a,t.Suspense=d,t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=w,t.__COMPILER_RUNTIME={__proto__:null,c:function(e){return w.H.useMemoCache(e)}},t.cache=function(e){return function(){return e.apply(null,arguments)}},t.cloneElement=function(e,t,r){if(null==e)throw Error("The argument must be a React element, but you passed "+e+".");var n=m({},e.props),i=e.key,s=void 0;if(null!=t)for(o in void 0!==t.ref&&(s=void 0),void 0!==t.key&&(i=""+t.key),t)S.call(t,o)&&"key"!==o&&"__self"!==o&&"__source"!==o&&("ref"!==o||void 0!==t.ref)&&(n[o]=t[o]);var o=arguments.length-2;if(1===o)n.children=r;else if(1<o){for(var a=Array(o),u=0;u<o;u++)a[u]=arguments[u+2];n.children=a}return ReactElement(e.type,i,void 0,void 0,s,n)},t.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider=e,e.Consumer={$$typeof:c,_context:e},e},t.createElement=function(e,t,r){var n,i={},s=null;if(null!=t)for(n in void 0!==t.key&&(s=""+t.key),t)S.call(t,n)&&"key"!==n&&"__self"!==n&&"__source"!==n&&(i[n]=t[n]);var o=arguments.length-2;if(1===o)i.children=r;else if(1<o){for(var a=Array(o),u=0;u<o;u++)a[u]=arguments[u+2];i.children=a}if(e&&e.defaultProps)for(n in o=e.defaultProps)void 0===i[n]&&(i[n]=o[n]);return ReactElement(e,s,void 0,void 0,null,i)},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:h,render:e}},t.isValidElement=isValidElement,t.lazy=function(e){return{$$typeof:g,_payload:{_status:-1,_result:e},_init:lazyInitializer}},t.memo=function(e,t){return{$$typeof:f,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=w.T,r={};w.T=r;try{var n=e(),i=w.S;null!==i&&i(r,n),"object"==typeof n&&null!==n&&"function"==typeof n.then&&n.then(noop,A)}catch(e){A(e)}finally{w.T=t}},t.unstable_useCacheRefresh=function(){return w.H.useCacheRefresh()},t.use=function(e){return w.H.use(e)},t.useActionState=function(e,t,r){return w.H.useActionState(e,t,r)},t.useCallback=function(e,t){return w.H.useCallback(e,t)},t.useContext=function(e){return w.H.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e,t){return w.H.useDeferredValue(e,t)},t.useEffect=function(e,t,r){var n=w.H;if("function"==typeof r)throw Error("useEffect CRUD overload is not enabled in this build of React.");return n.useEffect(e,t)},t.useId=function(){return w.H.useId()},t.useImperativeHandle=function(e,t,r){return w.H.useImperativeHandle(e,t,r)},t.useInsertionEffect=function(e,t){return w.H.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return w.H.useLayoutEffect(e,t)},t.useMemo=function(e,t){return w.H.useMemo(e,t)},t.useOptimistic=function(e,t){return w.H.useOptimistic(e,t)},t.useReducer=function(e,t,r){return w.H.useReducer(e,t,r)},t.useRef=function(e){return w.H.useRef(e)},t.useState=function(e){return w.H.useState(e)},t.useSyncExternalStore=function(e,t,r){return w.H.useSyncExternalStore(e,t,r)},t.useTransition=function(){return w.H.useTransition()},t.version="19.1.0"},7378:function(e,t,r){"use strict";e.exports=r(7983)},3481:function(e,t,r){"use strict";r.d(t,{P9:function(){return client_ConvexProvider},Zj:function(){return ConvexReactClient}});for(var n,i,s=r(7378),o=[],a=[],u=Uint8Array,c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",l=0,h=c.length;l<h;++l)o[l]=c[l],a[c.charCodeAt(l)]=l;function toByteArray(e){var t,r,n=function(e){var t=e.length;if(t%4>0)throw Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");-1===r&&(r=t);var n=r===t?0:4-r%4;return[r,n]}(e),i=n[0],s=n[1],o=new u((i+s)*3/4-s),c=0,l=s>0?i-4:i;for(r=0;r<l;r+=4)t=a[e.charCodeAt(r)]<<18|a[e.charCodeAt(r+1)]<<12|a[e.charCodeAt(r+2)]<<6|a[e.charCodeAt(r+3)],o[c++]=t>>16&255,o[c++]=t>>8&255,o[c++]=255&t;return 2===s&&(t=a[e.charCodeAt(r)]<<2|a[e.charCodeAt(r+1)]>>4,o[c++]=255&t),1===s&&(t=a[e.charCodeAt(r)]<<10|a[e.charCodeAt(r+1)]<<4|a[e.charCodeAt(r+2)]>>2,o[c++]=t>>8&255,o[c++]=255&t),o}function fromByteArray(e){for(var t,r=e.length,n=r%3,i=[],s=0,a=r-n;s<a;s+=16383)i.push(function(e,t,r){for(var n,i=[],s=t;s<r;s+=3)i.push(o[(n=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]))>>18&63]+o[n>>12&63]+o[n>>6&63]+o[63&n]);return i.join("")}(e,s,s+16383>a?a:s+16383));return 1===n?i.push(o[(t=e[r-1])>>2]+o[t<<4&63]+"=="):2===n&&i.push(o[(t=(e[r-2]<<8)+e[r-1])>>10]+o[t>>4&63]+o[t<<2&63]+"="),i.join("")}function common_parseArgs(e){if(void 0===e)return{};if(!isSimpleObject(e))throw Error(`The arguments to a Convex function must be an object. Received: ${e}`);return e}function isSimpleObject(e){let t="object"==typeof e,r=Object.getPrototypeOf(e),n=null===r||r===Object.prototype||r?.constructor?.name==="Object";return t&&n}a["-".charCodeAt(0)]=62,a["_".charCodeAt(0)]=63;let d=BigInt("-9223372036854775808"),f=BigInt("9223372036854775807"),g=BigInt("0"),p=BigInt("8"),y=BigInt("256");function isSpecial(e){return Number.isNaN(e)||!Number.isFinite(e)||Object.is(e,-0)}let m=DataView.prototype.setBigInt64?function(e){if(e<d||f<e)throw Error(`BigInt ${e} does not fit into a 64-bit signed integer.`);let t=new ArrayBuffer(8);return new DataView(t).setBigInt64(0,e,!0),fromByteArray(new Uint8Array(t))}:function(e){e<g&&(e-=d+d);let t=e.toString(16);t.length%2==1&&(t="0"+t);let r=new Uint8Array(new ArrayBuffer(8)),n=0;for(let i of t.match(/.{2}/g).reverse())r.set([parseInt(i,16)],n++),e>>=p;return fromByteArray(r)},b=DataView.prototype.getBigInt64?function(e){let t=toByteArray(e);if(8!==t.byteLength)throw Error(`Received ${t.byteLength} bytes, expected 8 for $integer`);let r=new DataView(t.buffer);return r.getBigInt64(0,!0)}:function(e){let t=toByteArray(e);if(8!==t.byteLength)throw Error(`Received ${t.byteLength} bytes, expected 8 for $integer`);let r=g,n=g;for(let e of t)r+=BigInt(e)*y**n,n++;return r>f&&(r+=d+d),r};function validateObjectField(e){if(e.length>1024)throw Error(`Field name ${e} exceeds maximum field name length 1024.`);if(e.startsWith("$"))throw Error(`Field name ${e} starts with a '$', which is reserved.`);for(let t=0;t<e.length;t+=1){let r=e.charCodeAt(t);if(r<32||r>=127)throw Error(`Field name ${e} has invalid character '${e[t]}': Field names can only contain non-control ASCII characters`)}}function value_jsonToConvex(e){if(null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e)return e;if(Array.isArray(e))return e.map(e=>value_jsonToConvex(e));if("object"!=typeof e)throw Error(`Unexpected type of ${e}`);let t=Object.entries(e);if(1===t.length){let r=t[0][0];if("$bytes"===r){if("string"!=typeof e.$bytes)throw Error(`Malformed $bytes field on ${e}`);return toByteArray(e.$bytes).buffer}if("$integer"===r){if("string"!=typeof e.$integer)throw Error(`Malformed $integer field on ${e}`);return b(e.$integer)}if("$float"===r){if("string"!=typeof e.$float)throw Error(`Malformed $float field on ${e}`);let t=toByteArray(e.$float);if(8!==t.byteLength)throw Error(`Received ${t.byteLength} bytes, expected 8 for $float`);let r=new DataView(t.buffer),n=r.getFloat64(0,!0);if(!isSpecial(n))throw Error(`Float ${n} should be encoded as a number`);return n}if("$set"===r)throw Error("Received a Set which is no longer supported as a Convex type.");if("$map"===r)throw Error("Received a Map which is no longer supported as a Convex type.")}let r={};for(let[t,n]of Object.entries(e))validateObjectField(t),r[t]=value_jsonToConvex(n);return r}function stringifyValueForError(e){return JSON.stringify(e,(e,t)=>void 0===t?"undefined":"bigint"==typeof t?`${t.toString()}n`:t)}function errorMessageForUnsupportedType(e,t,r,n){return e?`${t}${stringifyValueForError(r)} is not a supported Convex type (present at path ${e} in original object ${stringifyValueForError(n)}). To learn about Convex's supported types, see https://docs.convex.dev/using/types.`:`${t}${stringifyValueForError(r)} is not a supported Convex type.`}function value_convexToJson(e){return function convexToJsonInternal(e,t,r,n){if(void 0===e){let e=r&&` (present at path ${r} in original object ${stringifyValueForError(t)})`;throw Error(`undefined is not a valid Convex value${e}. To learn about Convex's supported types, see https://docs.convex.dev/using/types.`)}if(null===e)return e;if("bigint"==typeof e){if(e<d||f<e)throw Error(`BigInt ${e} does not fit into a 64-bit signed integer.`);return{$integer:m(e)}}if("number"==typeof e){if(!isSpecial(e))return e;{let t=new ArrayBuffer(8);return new DataView(t).setFloat64(0,e,!0),{$float:fromByteArray(new Uint8Array(t))}}}if("boolean"==typeof e||"string"==typeof e)return e;if(e instanceof ArrayBuffer)return{$bytes:fromByteArray(new Uint8Array(e))};if(Array.isArray(e))return e.map((e,n)=>convexToJsonInternal(e,t,r+`[${n}]`,!1));if(e instanceof Set)throw Error(errorMessageForUnsupportedType(r,"Set",[...e],t));if(e instanceof Map)throw Error(errorMessageForUnsupportedType(r,"Map",[...e],t));if(!isSimpleObject(e)){let n=e?.constructor?.name,i=n?`${n} `:"";throw Error(errorMessageForUnsupportedType(r,i,e,t))}let i={},s=Object.entries(e);for(let[e,o]of(s.sort(([e,t],[r,n])=>e===r?0:e<r?-1:1),s))void 0!==o?(validateObjectField(e),i[e]=convexToJsonInternal(o,t,r+`.${e}`,!1)):n&&(validateObjectField(e),i[e]=function(e,t,r){if(void 0===e)return{$undefined:null};if(void 0===t)throw Error(`Programming error. Current value is ${stringifyValueForError(e)} but original value is undefined`);return convexToJsonInternal(e,t,r,!1)}(o,t,r+`.${e}`));return i}(e,e,"",!1)}var v=Object.defineProperty,errors_defNormalProp=(e,t,r)=>t in e?v(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,errors_publicField=(e,t,r)=>errors_defNormalProp(e,"symbol"!=typeof t?t+"":t,r);let _=Symbol.for("ConvexError");let errors_ConvexError=class errors_ConvexError extends(i=Error,n=_,i){constructor(e){super("string"==typeof e?e:stringifyValueForError(e)),errors_publicField(this,"name","ConvexError"),errors_publicField(this,"data"),errors_publicField(this,n,!0),this.data=e}};let arr=()=>Array.from({length:4},()=>0);arr(),arr();let w="1.24.1";var S=Object.defineProperty,logging_defNormalProp=(e,t,r)=>t in e?S(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,logging_publicField=(e,t,r)=>logging_defNormalProp(e,"symbol"!=typeof t?t+"":t,r);function prefix_for_source(e){switch(e){case"query":return"Q";case"mutation":return"M";case"action":return"A";case"any":return"?"}}let Logger=class Logger{constructor(e){logging_publicField(this,"_onLogLineFuncs"),logging_publicField(this,"_verbose"),this._onLogLineFuncs={},this._verbose=e.verbose}addLogLineListener(e){let t=Math.random().toString(36).substring(2,15);for(let e=0;e<10&&void 0!==this._onLogLineFuncs[t];e++)t=Math.random().toString(36).substring(2,15);return this._onLogLineFuncs[t]=e,()=>{delete this._onLogLineFuncs[t]}}logVerbose(...e){if(this._verbose)for(let t of Object.values(this._onLogLineFuncs))t("debug",`${new Date().toISOString()}`,...e)}log(...e){for(let t of Object.values(this._onLogLineFuncs))t("info",...e)}warn(...e){for(let t of Object.values(this._onLogLineFuncs))t("warn",...e)}error(...e){for(let t of Object.values(this._onLogLineFuncs))t("error",...e)}};function logging_instantiateDefaultLogger(e){let t=new Logger(e);return t.addLogLineListener((e,...t)=>{switch(e){case"debug":console.debug(...t);break;case"info":default:console.log(...t);break;case"warn":console.warn(...t);break;case"error":console.error(...t)}}),t}function logging_logForFunction(e,t,r,n,i){let s=prefix_for_source(r);if("object"==typeof i&&(i=`ConvexError ${JSON.stringify(i.errorData,null,2)}`),"info"===t){let t=i.match(/^\[.*?\] /);if(null===t){e.error(`[CONVEX ${s}(${n})] Could not parse console.log`);return}let r=i.slice(1,t[0].length-2),o=i.slice(t[0].length);e.log(`%c[CONVEX ${s}(${n})] [${r}]`,"color:rgb(0, 145, 255)",o)}else e.error(`[CONVEX ${s}(${n})] ${i}`)}function createHybridErrorStacktrace(e,t,r){let n=prefix_for_source(e);return`[CONVEX ${n}(${t})] ${r.errorMessage}
  Called by client`}function forwardData(e,t){return t.data=e.errorData,t}function canonicalizeUdfPath(e){let t,r;let n=e.split(":");return 1===n.length?(t=n[0],r="default"):(t=n.slice(0,n.length-1).join(":"),r=n[n.length-1]),t.endsWith(".js")&&(t=t.slice(0,-3)),`${t}:${r}`}function serializePathAndArgs(e,t){return JSON.stringify({udfPath:canonicalizeUdfPath(e),args:value_convexToJson(t)})}var k=Object.defineProperty,local_state_defNormalProp=(e,t,r)=>t in e?k(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,local_state_publicField=(e,t,r)=>local_state_defNormalProp(e,"symbol"!=typeof t?t+"":t,r);let LocalSyncState=class LocalSyncState{constructor(){local_state_publicField(this,"nextQueryId"),local_state_publicField(this,"querySetVersion"),local_state_publicField(this,"querySet"),local_state_publicField(this,"queryIdToToken"),local_state_publicField(this,"identityVersion"),local_state_publicField(this,"auth"),local_state_publicField(this,"outstandingQueriesOlderThanRestart"),local_state_publicField(this,"outstandingAuthOlderThanRestart"),local_state_publicField(this,"paused"),local_state_publicField(this,"pendingQuerySetModifications"),this.nextQueryId=0,this.querySetVersion=0,this.identityVersion=0,this.querySet=new Map,this.queryIdToToken=new Map,this.outstandingQueriesOlderThanRestart=new Set,this.outstandingAuthOlderThanRestart=!1,this.paused=!1,this.pendingQuerySetModifications=new Map}hasSyncedPastLastReconnect(){return 0===this.outstandingQueriesOlderThanRestart.size&&!this.outstandingAuthOlderThanRestart}markAuthCompletion(){this.outstandingAuthOlderThanRestart=!1}subscribe(e,t,r,n){let i=canonicalizeUdfPath(e),s=serializePathAndArgs(i,t),o=this.querySet.get(s);if(void 0!==o)return o.numSubscribers+=1,{queryToken:s,modification:null,unsubscribe:()=>this.removeSubscriber(s)};{let e=this.nextQueryId++;this.querySet.set(s,{id:e,canonicalizedUdfPath:i,args:t,numSubscribers:1,journal:r,componentPath:n}),this.queryIdToToken.set(e,s);let o=this.querySetVersion,a=this.querySetVersion+1,u={type:"Add",queryId:e,udfPath:i,args:[value_convexToJson(t)],journal:r,componentPath:n};return this.paused?this.pendingQuerySetModifications.set(e,u):this.querySetVersion=a,{queryToken:s,modification:{type:"ModifyQuerySet",baseVersion:o,newVersion:a,modifications:[u]},unsubscribe:()=>this.removeSubscriber(s)}}}transition(e){for(let t of e.modifications)switch(t.type){case"QueryUpdated":case"QueryFailed":{this.outstandingQueriesOlderThanRestart.delete(t.queryId);let e=t.journal;if(void 0!==e){let r=this.queryIdToToken.get(t.queryId);void 0!==r&&(this.querySet.get(r).journal=e)}break}case"QueryRemoved":this.outstandingQueriesOlderThanRestart.delete(t.queryId);break;default:throw Error(`Invalid modification ${t.type}`)}}queryId(e,t){let r=canonicalizeUdfPath(e),n=serializePathAndArgs(r,t),i=this.querySet.get(n);return void 0!==i?i.id:null}isCurrentOrNewerAuthVersion(e){return e>=this.identityVersion}setAuth(e){this.auth={tokenType:"User",value:e};let t=this.identityVersion;return this.paused||(this.identityVersion=t+1),{type:"Authenticate",baseVersion:t,...this.auth}}setAdminAuth(e,t){let r={tokenType:"Admin",value:e,impersonating:t};this.auth=r;let n=this.identityVersion;return this.paused||(this.identityVersion=n+1),{type:"Authenticate",baseVersion:n,...r}}clearAuth(){this.auth=void 0,this.markAuthCompletion();let e=this.identityVersion;return this.paused||(this.identityVersion=e+1),{type:"Authenticate",tokenType:"None",baseVersion:e}}hasAuth(){return!!this.auth}isNewAuth(e){return this.auth?.value!==e}queryPath(e){let t=this.queryIdToToken.get(e);return t?this.querySet.get(t).canonicalizedUdfPath:null}queryArgs(e){let t=this.queryIdToToken.get(e);return t?this.querySet.get(t).args:null}queryToken(e){return this.queryIdToToken.get(e)??null}queryJournal(e){return this.querySet.get(e)?.journal}restart(e){this.unpause(),this.outstandingQueriesOlderThanRestart.clear();let t=[];for(let r of this.querySet.values()){let n={type:"Add",queryId:r.id,udfPath:r.canonicalizedUdfPath,args:[value_convexToJson(r.args)],journal:r.journal,componentPath:r.componentPath};t.push(n),e.has(r.id)||this.outstandingQueriesOlderThanRestart.add(r.id)}this.querySetVersion=1;let r={type:"ModifyQuerySet",baseVersion:0,newVersion:1,modifications:t};if(!this.auth)return this.identityVersion=0,[r,void 0];this.outstandingAuthOlderThanRestart=!0;let n={type:"Authenticate",baseVersion:0,...this.auth};return this.identityVersion=1,[r,n]}pause(){this.paused=!0}resume(){let e=this.pendingQuerySetModifications.size>0?{type:"ModifyQuerySet",baseVersion:this.querySetVersion,newVersion:++this.querySetVersion,modifications:Array.from(this.pendingQuerySetModifications.values())}:void 0,t=void 0!==this.auth?{type:"Authenticate",baseVersion:this.identityVersion++,...this.auth}:void 0;return this.unpause(),[e,t]}unpause(){this.paused=!1,this.pendingQuerySetModifications.clear()}removeSubscriber(e){let t=this.querySet.get(e);if(t.numSubscribers>1)return t.numSubscribers-=1,null;{this.querySet.delete(e),this.queryIdToToken.delete(t.id),this.outstandingQueriesOlderThanRestart.delete(t.id);let r=this.querySetVersion,n=this.querySetVersion+1,i={type:"Remove",queryId:t.id};return this.paused?this.pendingQuerySetModifications.has(t.id)?this.pendingQuerySetModifications.delete(t.id):this.pendingQuerySetModifications.set(t.id,i):this.querySetVersion=n,{type:"ModifyQuerySet",baseVersion:r,newVersion:n,modifications:[i]}}}};var A=Object.defineProperty,request_manager_defNormalProp=(e,t,r)=>t in e?A(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,request_manager_publicField=(e,t,r)=>request_manager_defNormalProp(e,"symbol"!=typeof t?t+"":t,r);let RequestManager=class RequestManager{constructor(e){this.logger=e,request_manager_publicField(this,"inflightRequests"),request_manager_publicField(this,"requestsOlderThanRestart"),request_manager_publicField(this,"inflightMutationsCount",0),request_manager_publicField(this,"inflightActionsCount",0),this.inflightRequests=new Map,this.requestsOlderThanRestart=new Set}request(e,t){let r=new Promise(r=>{this.inflightRequests.set(e.requestId,{message:e,status:{status:t?"Requested":"NotSent",requestedAt:new Date,onResult:r}}),"Mutation"===e.type?this.inflightMutationsCount++:"Action"===e.type&&this.inflightActionsCount++});return r}onResponse(e){let t,r;let n=this.inflightRequests.get(e.requestId);if(void 0===n||"Completed"===n.status.status)return null;let i="Mutation"===n.message.type?"mutation":"action",s=n.message.udfPath;for(let t of e.logLines)logging_logForFunction(this.logger,"info",i,s,t);let o=n.status;if(e.success)t={success:!0,logLines:e.logLines,value:value_jsonToConvex(e.result)},r=()=>o.onResult(t);else{let n=e.result,{errorData:a}=e;logging_logForFunction(this.logger,"error",i,s,n),t={success:!1,errorMessage:n,errorData:void 0!==a?value_jsonToConvex(a):void 0,logLines:e.logLines},r=()=>o.onResult(t)}return"ActionResponse"!==e.type&&e.success?(n.status={status:"Completed",result:t,ts:e.ts,onResolve:r},null):(r(),this.inflightRequests.delete(e.requestId),this.requestsOlderThanRestart.delete(e.requestId),"Action"===n.message.type?this.inflightActionsCount--:"Mutation"===n.message.type&&this.inflightMutationsCount--,{requestId:e.requestId,result:t})}removeCompleted(e){let t=new Map;for(let[r,n]of this.inflightRequests.entries()){let i=n.status;"Completed"===i.status&&i.ts.lessThanOrEqual(e)&&(i.onResolve(),t.set(r,i.result),"Mutation"===n.message.type?this.inflightMutationsCount--:"Action"===n.message.type&&this.inflightActionsCount--,this.inflightRequests.delete(r),this.requestsOlderThanRestart.delete(r))}return t}restart(){this.requestsOlderThanRestart=new Set(this.inflightRequests.keys());let e=[];for(let[t,r]of this.inflightRequests){if("NotSent"===r.status.status){r.status.status="Requested",e.push(r.message);continue}if("Mutation"===r.message.type)e.push(r.message);else if("Action"===r.message.type){if(this.inflightRequests.delete(t),this.requestsOlderThanRestart.delete(t),this.inflightActionsCount--,"Completed"===r.status.status)throw Error("Action should never be in 'Completed' state");r.status.onResult({success:!1,errorMessage:"Connection lost while action was in flight",logLines:[]})}}return e}resume(){let e=[];for(let[,t]of this.inflightRequests)if("NotSent"===t.status.status){t.status.status="Requested",e.push(t.message);continue}return e}hasIncompleteRequests(){for(let e of this.inflightRequests.values())if("Requested"===e.status.status)return!0;return!1}hasInflightRequests(){return this.inflightRequests.size>0}hasSyncedPastLastReconnect(){return 0===this.requestsOlderThanRestart.size}timeOfOldestInflightRequest(){if(0===this.inflightRequests.size)return null;let e=Date.now();for(let t of this.inflightRequests.values())"Completed"!==t.status.status&&t.status.requestedAt.getTime()<e&&(e=t.status.requestedAt.getTime());return new Date(e)}inflightMutations(){return this.inflightMutationsCount}inflightActions(){return this.inflightActionsCount}};let R=Symbol.for("functionName"),C=Symbol.for("toReferencePath");function api_getFunctionName(e){let t=function(e){let t;if("string"==typeof e)t=e.startsWith("function://")?{functionHandle:e}:{name:e};else if(e[R])t={name:e[R]};else{let r=e[C]??null;if(!r)throw Error(`${e} is not a functionReference`);t={reference:r}}return t}(e);if(void 0===t.name){if(void 0!==t.functionHandle)throw Error(`Expected function reference like "api.file.func" or "internal.file.func", but received function handle ${t.functionHandle}`);if(void 0!==t.reference)throw Error(`Expected function reference in the current component like "api.file.func" or "internal.file.func", but received reference ${t.reference}`);throw Error(`Expected function reference like "api.file.func" or "internal.file.func", but received ${JSON.stringify(t)}`)}if("string"==typeof e)return e;let r=e[R];if(!r)throw Error(`${e} is not a functionReference`);return r}!function createApi(e=[]){return new Proxy({},{get(t,r){if("string"==typeof r){let t=[...e,r];return createApi(t)}if(r===R){if(e.length<2){let t=["api",...e].join(".");throw Error(`API path is expected to be of the form \`api.moduleName.functionName\`. Found: \`${t}\``)}let t=e.slice(0,-1).join("/"),r=e[e.length-1];return"default"===r?t:t+":"+r}return r===Symbol.toStringTag?"FunctionReference":void 0}})}();var T=Object.defineProperty,optimistic_updates_impl_defNormalProp=(e,t,r)=>t in e?T(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,optimistic_updates_impl_publicField=(e,t,r)=>optimistic_updates_impl_defNormalProp(e,"symbol"!=typeof t?t+"":t,r);let OptimisticLocalStoreImpl=class OptimisticLocalStoreImpl{constructor(e){optimistic_updates_impl_publicField(this,"queryResults"),optimistic_updates_impl_publicField(this,"modifiedQueries"),this.queryResults=e,this.modifiedQueries=[]}getQuery(e,...t){let r=common_parseArgs(t[0]),n=api_getFunctionName(e),i=this.queryResults.get(serializePathAndArgs(n,r));if(void 0!==i)return OptimisticLocalStoreImpl.queryValue(i.result)}getAllQueries(e){let t=[],r=api_getFunctionName(e);for(let e of this.queryResults.values())e.udfPath===canonicalizeUdfPath(r)&&t.push({args:e.args,value:OptimisticLocalStoreImpl.queryValue(e.result)});return t}setQuery(e,t,r){let n=common_parseArgs(t),i=api_getFunctionName(e),s=serializePathAndArgs(i,n);this.queryResults.set(s,{udfPath:i,args:n,result:void 0===r?void 0:{success:!0,value:r,logLines:[]}}),this.modifiedQueries.push(s)}static queryValue(e){return void 0===e?void 0:e.success?e.value:void 0}};let OptimisticQueryResults=class OptimisticQueryResults{constructor(){optimistic_updates_impl_publicField(this,"queryResults"),optimistic_updates_impl_publicField(this,"optimisticUpdates"),this.queryResults=new Map,this.optimisticUpdates=[]}ingestQueryResultsFromServer(e,t){this.optimisticUpdates=this.optimisticUpdates.filter(e=>!t.has(e.mutationId));let r=this.queryResults;this.queryResults=new Map(e);let n=new OptimisticLocalStoreImpl(this.queryResults);for(let e of this.optimisticUpdates)e.update(n);let i=[];for(let[e,t]of this.queryResults){let n=r.get(e);(void 0===n||n.result!==t.result)&&i.push(e)}return i}applyOptimisticUpdate(e,t){this.optimisticUpdates.push({update:e,mutationId:t});let r=new OptimisticLocalStoreImpl(this.queryResults);return e(r),r.modifiedQueries}queryResult(e){let t=this.queryResults.get(e);if(void 0===t)return;let r=t.result;if(void 0!==r){if(r.success)return r.value;if(void 0!==r.errorData)throw forwardData(r,new errors_ConvexError(createHybridErrorStacktrace("query",t.udfPath,r)));throw Error(createHybridErrorStacktrace("query",t.udfPath,r))}}hasQueryResult(e){return void 0!==this.queryResults.get(e)}queryLogs(e){let t=this.queryResults.get(e);return t?.result?.logLines}};var q=Object.defineProperty,long_defNormalProp=(e,t,r)=>t in e?q(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,long_publicField=(e,t,r)=>long_defNormalProp(e,"symbol"!=typeof t?t+"":t,r);let Long=class Long{constructor(e,t){long_publicField(this,"low"),long_publicField(this,"high"),long_publicField(this,"__isUnsignedLong__"),this.low=0|e,this.high=0|t,this.__isUnsignedLong__=!0}static isLong(e){return!0===(e&&e.__isUnsignedLong__)}static fromBytesLE(e){return new Long(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24)}toBytesLE(){let e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]}static fromNumber(e){return isNaN(e)||e<0?F:e>=x?I:new Long(e%E|0,e/E|0)}toString(){return(BigInt(this.high)*BigInt(E)+BigInt(this.low)).toString()}equals(e){return Long.isLong(e)||(e=Long.fromValue(e)),(this.high>>>31!=1||e.high>>>31!=1)&&this.high===e.high&&this.low===e.low}notEquals(e){return!this.equals(e)}comp(e){return(Long.isLong(e)||(e=Long.fromValue(e)),this.equals(e))?0:e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1}lessThanOrEqual(e){return 0>=this.comp(e)}static fromValue(e){return"number"==typeof e?Long.fromNumber(e):new Long(e.low,e.high)}};let F=new Long(0,0),E=4294967296,x=E*E,I=new Long(-1,-1);var M=Object.defineProperty,remote_query_set_defNormalProp=(e,t,r)=>t in e?M(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,remote_query_set_publicField=(e,t,r)=>remote_query_set_defNormalProp(e,"symbol"!=typeof t?t+"":t,r);let RemoteQuerySet=class RemoteQuerySet{constructor(e,t){remote_query_set_publicField(this,"version"),remote_query_set_publicField(this,"remoteQuerySet"),remote_query_set_publicField(this,"queryPath"),remote_query_set_publicField(this,"logger"),this.version={querySet:0,ts:Long.fromNumber(0),identity:0},this.remoteQuerySet=new Map,this.queryPath=e,this.logger=t}transition(e){let t=e.startVersion;if(this.version.querySet!==t.querySet||this.version.ts.notEquals(t.ts)||this.version.identity!==t.identity)throw Error(`Invalid start version: ${t.ts.toString()}:${t.querySet}`);for(let t of e.modifications)switch(t.type){case"QueryUpdated":{let e=this.queryPath(t.queryId);if(e)for(let r of t.logLines)logging_logForFunction(this.logger,"info","query",e,r);let r=value_jsonToConvex(t.value??null);this.remoteQuerySet.set(t.queryId,{success:!0,value:r,logLines:t.logLines});break}case"QueryFailed":{let e=this.queryPath(t.queryId);if(e)for(let r of t.logLines)logging_logForFunction(this.logger,"info","query",e,r);let{errorData:r}=t;this.remoteQuerySet.set(t.queryId,{success:!1,errorMessage:t.errorMessage,errorData:void 0!==r?value_jsonToConvex(r):void 0,logLines:t.logLines});break}case"QueryRemoved":this.remoteQuerySet.delete(t.queryId);break;default:throw Error(`Invalid modification ${t.type}`)}this.version=e.endVersion}remoteQueryResults(){return this.remoteQuerySet}timestamp(){return this.version.ts}};function u64ToLong(e){let t=toByteArray(e);return Long.fromBytesLE(Array.from(t))}var O=Object.defineProperty,web_socket_manager_defNormalProp=(e,t,r)=>t in e?O(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,web_socket_manager_publicField=(e,t,r)=>web_socket_manager_defNormalProp(e,"symbol"!=typeof t?t+"":t,r);let WebSocketManager=class WebSocketManager{constructor(e,t,r,n){web_socket_manager_publicField(this,"socket"),web_socket_manager_publicField(this,"connectionCount"),web_socket_manager_publicField(this,"_hasEverConnected",!1),web_socket_manager_publicField(this,"lastCloseReason"),web_socket_manager_publicField(this,"initialBackoff"),web_socket_manager_publicField(this,"maxBackoff"),web_socket_manager_publicField(this,"retries"),web_socket_manager_publicField(this,"serverInactivityThreshold"),web_socket_manager_publicField(this,"reconnectDueToServerInactivityTimeout"),web_socket_manager_publicField(this,"uri"),web_socket_manager_publicField(this,"onOpen"),web_socket_manager_publicField(this,"onResume"),web_socket_manager_publicField(this,"onMessage"),web_socket_manager_publicField(this,"webSocketConstructor"),web_socket_manager_publicField(this,"logger"),this.webSocketConstructor=r,this.socket={state:"disconnected"},this.connectionCount=0,this.lastCloseReason="InitialConnect",this.initialBackoff=100,this.maxBackoff=16e3,this.retries=0,this.serverInactivityThreshold=3e4,this.reconnectDueToServerInactivityTimeout=null,this.uri=e,this.onOpen=t.onOpen,this.onResume=t.onResume,this.onMessage=t.onMessage,this.logger=n,this.connect()}setSocketState(e){this.socket=e,this._logVerbose(`socket state changed: ${this.socket.state}, paused: ${"paused"in this.socket?this.socket.paused:void 0}`)}connect(){if("terminated"===this.socket.state)return;if("disconnected"!==this.socket.state&&"stopped"!==this.socket.state)throw Error("Didn't start connection from disconnected state: "+this.socket.state);let e=new this.webSocketConstructor(this.uri);this._logVerbose("constructed WebSocket"),this.setSocketState({state:"connecting",ws:e,paused:"no"}),this.resetServerInactivityTimeout(),e.onopen=()=>{if(this.logger.logVerbose("begin ws.onopen"),"connecting"!==this.socket.state)throw Error("onopen called with socket not in connecting state");this.setSocketState({state:"ready",ws:e,paused:"yes"===this.socket.paused?"uninitialized":"no"}),this.resetServerInactivityTimeout(),"no"===this.socket.paused&&(this._hasEverConnected=!0,this.onOpen({connectionCount:this.connectionCount,lastCloseReason:this.lastCloseReason})),"InitialConnect"!==this.lastCloseReason&&this.logger.log("WebSocket reconnected"),this.connectionCount+=1,this.lastCloseReason=null},e.onerror=e=>{let t=e.message;this.logger.log(`WebSocket error: ${t}`)},e.onmessage=e=>{this.resetServerInactivityTimeout();let t=function(e){switch(e.type){case"FatalError":case"AuthError":case"ActionResponse":case"Ping":return{...e};case"MutationResponse":if(e.success)return{...e,ts:u64ToLong(e.ts)};return{...e};case"Transition":return{...e,startVersion:{...e.startVersion,ts:u64ToLong(e.startVersion.ts)},endVersion:{...e.endVersion,ts:u64ToLong(e.endVersion.ts)}}}}(JSON.parse(e.data));this._logVerbose(`received ws message with type ${t.type}`);let r=this.onMessage(t);r.hasSyncedPastLastReconnect&&(this.retries=0)},e.onclose=e=>{if(this._logVerbose("begin ws.onclose"),null===this.lastCloseReason&&(this.lastCloseReason=e.reason??"OnCloseInvoked"),1e3!==e.code&&1001!==e.code&&1005!==e.code&&4040!==e.code){let t=`WebSocket closed with code ${e.code}`;e.reason&&(t+=`: ${e.reason}`),this.logger.log(t)}this.scheduleReconnect()}}socketState(){return this.socket.state}sendMessage(e){let t={type:e.type,..."Authenticate"===e.type&&"User"===e.tokenType?{value:`...${e.value.slice(-7)}`}:{}};if("ready"===this.socket.state&&"no"===this.socket.paused){let r=function(e){switch(e.type){case"Authenticate":case"ModifyQuerySet":case"Mutation":case"Action":case"Event":return{...e};case"Connect":if(void 0!==e.maxObservedTimestamp)return{...e,maxObservedTimestamp:function(e){let t=new Uint8Array(e.toBytesLE());return fromByteArray(t)}(e.maxObservedTimestamp)};return{...e,maxObservedTimestamp:void 0}}}(e),n=JSON.stringify(r);try{this.socket.ws.send(n)}catch(e){this.logger.log(`Failed to send message on WebSocket, reconnecting: ${e}`),this.closeAndReconnect("FailedToSendMessage")}return this._logVerbose(`sent message with type ${e.type}: ${JSON.stringify(t)}`),!0}return this._logVerbose(`message not sent (socket state: ${this.socket.state}, paused: ${"paused"in this.socket?this.socket.paused:void 0}): ${JSON.stringify(t)}`),!1}resetServerInactivityTimeout(){"terminated"!==this.socket.state&&(null!==this.reconnectDueToServerInactivityTimeout&&(clearTimeout(this.reconnectDueToServerInactivityTimeout),this.reconnectDueToServerInactivityTimeout=null),this.reconnectDueToServerInactivityTimeout=setTimeout(()=>{this.closeAndReconnect("InactiveServer")},this.serverInactivityThreshold))}scheduleReconnect(){this.socket={state:"disconnected"};let e=this.nextBackoff();this.logger.log(`Attempting reconnect in ${e}ms`),setTimeout(()=>this.connect(),e)}closeAndReconnect(e){switch(this._logVerbose(`begin closeAndReconnect with reason ${e}`),this.socket.state){case"disconnected":case"terminated":case"stopped":return;case"connecting":case"ready":this.lastCloseReason=e,this.close(),this.scheduleReconnect();return;default:this.socket}}close(){switch(this.socket.state){case"disconnected":case"terminated":case"stopped":return Promise.resolve();case"connecting":{let e=this.socket.ws;return new Promise(t=>{e.onclose=()=>{this._logVerbose("Closed after connecting"),t()},e.onopen=()=>{this._logVerbose("Opened after connecting"),e.close()}})}case"ready":{this._logVerbose("ws.close called");let e=this.socket.ws,t=new Promise(t=>{e.onclose=()=>{t()}});return e.close(),t}default:return this.socket,Promise.resolve()}}terminate(){switch(this.reconnectDueToServerInactivityTimeout&&clearTimeout(this.reconnectDueToServerInactivityTimeout),this.socket.state){case"terminated":case"stopped":case"disconnected":case"connecting":case"ready":{let e=this.close();return this.setSocketState({state:"terminated"}),e}default:throw this.socket,Error(`Invalid websocket state: ${this.socket.state}`)}}stop(){switch(this.socket.state){case"terminated":return Promise.resolve();case"connecting":case"stopped":case"disconnected":case"ready":{let e=this.close();return this.socket={state:"stopped"},e}default:return this.socket,Promise.resolve()}}tryRestart(){switch(this.socket.state){case"stopped":break;case"terminated":case"connecting":case"ready":case"disconnected":this.logger.logVerbose("Restart called without stopping first");return;default:this.socket}this.connect()}pause(){switch(this.socket.state){case"disconnected":case"stopped":case"terminated":return;case"connecting":case"ready":this.socket={...this.socket,paused:"yes"};return;default:this.socket;return}}resume(){switch(this.socket.state){case"connecting":this.socket={...this.socket,paused:"no"};return;case"ready":"uninitialized"===this.socket.paused?(this.socket={...this.socket,paused:"no"},this.onOpen({connectionCount:this.connectionCount,lastCloseReason:this.lastCloseReason})):"yes"===this.socket.paused&&(this.socket={...this.socket,paused:"no"},this.onResume());return;case"terminated":case"stopped":case"disconnected":return;default:this.socket}this.connect()}connectionState(){return{isConnected:"ready"===this.socket.state,hasEverConnected:this._hasEverConnected,connectionCount:this.connectionCount,connectionRetries:this.retries}}_logVerbose(e){this.logger.logVerbose(e)}nextBackoff(){let e=this.initialBackoff*Math.pow(2,this.retries);this.retries+=1;let t=Math.min(e,this.maxBackoff);return t+t*(Math.random()-.5)}};let InvalidTokenError=class InvalidTokenError extends Error{};InvalidTokenError.prototype.name="InvalidTokenError";var $=Object.defineProperty,authentication_manager_defNormalProp=(e,t,r)=>t in e?$(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,authentication_manager_publicField=(e,t,r)=>authentication_manager_defNormalProp(e,"symbol"!=typeof t?t+"":t,r);let AuthenticationManager=class AuthenticationManager{constructor(e,t,r){authentication_manager_publicField(this,"authState",{state:"noAuth"}),authentication_manager_publicField(this,"configVersion",0),authentication_manager_publicField(this,"syncState"),authentication_manager_publicField(this,"authenticate"),authentication_manager_publicField(this,"stopSocket"),authentication_manager_publicField(this,"tryRestartSocket"),authentication_manager_publicField(this,"pauseSocket"),authentication_manager_publicField(this,"resumeSocket"),authentication_manager_publicField(this,"clearAuth"),authentication_manager_publicField(this,"logger"),authentication_manager_publicField(this,"refreshTokenLeewaySeconds"),authentication_manager_publicField(this,"tokenConfirmationAttempts",0),this.syncState=e,this.authenticate=t.authenticate,this.stopSocket=t.stopSocket,this.tryRestartSocket=t.tryRestartSocket,this.pauseSocket=t.pauseSocket,this.resumeSocket=t.resumeSocket,this.clearAuth=t.clearAuth,this.logger=r.logger,this.refreshTokenLeewaySeconds=r.refreshTokenLeewaySeconds}async setConfig(e,t){this.resetAuthState(),this._logVerbose("pausing WS for auth token fetch"),this.pauseSocket();let r=await this.fetchTokenAndGuardAgainstRace(e,{forceRefreshToken:!1});r.isFromOutdatedConfig||(r.value?(this.setAuthState({state:"waitingForServerConfirmationOfCachedToken",config:{fetchToken:e,onAuthChange:t},hasRetried:!1}),this.authenticate(r.value)):(this.setAuthState({state:"initialRefetch",config:{fetchToken:e,onAuthChange:t}}),await this.refetchToken()),this._logVerbose("resuming WS after auth token fetch"),this.resumeSocket())}onTransition(e){if(this.syncState.isCurrentOrNewerAuthVersion(e.endVersion.identity)&&!(e.endVersion.identity<=e.startVersion.identity)){if("waitingForServerConfirmationOfCachedToken"===this.authState.state){this._logVerbose("server confirmed auth token is valid"),this.refetchToken(),this.authState.config.onAuthChange(!0);return}"waitingForServerConfirmationOfFreshToken"!==this.authState.state||(this._logVerbose("server confirmed new auth token is valid"),this.scheduleTokenRefetch(this.authState.token),this.tokenConfirmationAttempts=0,this.authState.hadAuth||this.authState.config.onAuthChange(!0))}}onAuthError(e){if(!1===e.authUpdateAttempted&&("waitingForServerConfirmationOfFreshToken"===this.authState.state||"waitingForServerConfirmationOfCachedToken"===this.authState.state)){this._logVerbose("ignoring non-auth token expired error");return}let{baseVersion:t}=e;if(!this.syncState.isCurrentOrNewerAuthVersion(t+1)){this._logVerbose("ignoring auth error for previous auth attempt");return}this.tryToReauthenticate(e)}async tryToReauthenticate(e){if(this._logVerbose(`attempting to reauthenticate: ${e.error}`),"noAuth"===this.authState.state||"waitingForServerConfirmationOfFreshToken"===this.authState.state&&this.tokenConfirmationAttempts>=2){this.logger.error(`Failed to authenticate: "${e.error}", check your server auth config`),this.syncState.hasAuth()&&this.syncState.clearAuth(),"noAuth"!==this.authState.state&&this.setAndReportAuthFailed(this.authState.config.onAuthChange);return}"waitingForServerConfirmationOfFreshToken"===this.authState.state&&(this.tokenConfirmationAttempts++,this._logVerbose(`retrying reauthentication, ${2-this.tokenConfirmationAttempts} attempts remaining`)),await this.stopSocket();let t=await this.fetchTokenAndGuardAgainstRace(this.authState.config.fetchToken,{forceRefreshToken:!0});t.isFromOutdatedConfig||(t.value&&this.syncState.isNewAuth(t.value)?(this.authenticate(t.value),this.setAuthState({state:"waitingForServerConfirmationOfFreshToken",config:this.authState.config,token:t.value,hadAuth:"notRefetching"===this.authState.state||"waitingForScheduledRefetch"===this.authState.state})):(this._logVerbose("reauthentication failed, could not fetch a new token"),this.syncState.hasAuth()&&this.syncState.clearAuth(),this.setAndReportAuthFailed(this.authState.config.onAuthChange)),this.tryRestartSocket())}async refetchToken(){if("noAuth"===this.authState.state)return;this._logVerbose("refetching auth token");let e=await this.fetchTokenAndGuardAgainstRace(this.authState.config.fetchToken,{forceRefreshToken:!0});e.isFromOutdatedConfig||(e.value?this.syncState.isNewAuth(e.value)?(this.setAuthState({state:"waitingForServerConfirmationOfFreshToken",hadAuth:this.syncState.hasAuth(),token:e.value,config:this.authState.config}),this.authenticate(e.value)):this.setAuthState({state:"notRefetching",config:this.authState.config}):(this._logVerbose("refetching token failed"),this.syncState.hasAuth()&&this.clearAuth(),this.setAndReportAuthFailed(this.authState.config.onAuthChange)),this._logVerbose("restarting WS after auth token fetch (if currently stopped)"),this.tryRestartSocket())}scheduleTokenRefetch(e){if("noAuth"===this.authState.state)return;let t=this.decodeToken(e);if(!t){this.logger.error("Auth token is not a valid JWT, cannot refetch the token");return}let{iat:r,exp:n}=t;if(!r||!n){this.logger.error("Auth token does not have required fields, cannot refetch the token");return}let i=n-r;if(i<=2){this.logger.error("Auth token does not live long enough, cannot refetch the token");return}let s=Math.min(1728e6,(i-this.refreshTokenLeewaySeconds)*1e3);s<=0&&(this.logger.warn(`Refetching auth token immediately, configured leeway ${this.refreshTokenLeewaySeconds}s is larger than the token's lifetime ${i}s`),s=0);let o=setTimeout(()=>{this._logVerbose("running scheduled token refetch"),this.refetchToken()},s);this.setAuthState({state:"waitingForScheduledRefetch",refetchTokenTimeoutId:o,config:this.authState.config}),this._logVerbose(`scheduled preemptive auth token refetching in ${s}ms`)}async fetchTokenAndGuardAgainstRace(e,t){let r=++this.configVersion;this._logVerbose(`fetching token with config version ${r}`);let n=await e(t);return this.configVersion!==r?(this._logVerbose(`stale config version, expected ${r}, got ${this.configVersion}`),{isFromOutdatedConfig:!0}):{isFromOutdatedConfig:!1,value:n}}stop(){this.resetAuthState(),this.configVersion++,this._logVerbose(`config version bumped to ${this.configVersion}`)}setAndReportAuthFailed(e){e(!1),this.resetAuthState()}resetAuthState(){this.setAuthState({state:"noAuth"})}setAuthState(e){let t="waitingForServerConfirmationOfFreshToken"===e.state?{hadAuth:e.hadAuth,state:e.state,token:`...${e.token.slice(-7)}`}:{state:e.state};switch(this._logVerbose(`setting auth state to ${JSON.stringify(t)}`),e.state){case"waitingForScheduledRefetch":case"notRefetching":case"noAuth":this.tokenConfirmationAttempts=0}"waitingForScheduledRefetch"===this.authState.state&&(clearTimeout(this.authState.refetchTokenTimeoutId),this.syncState.markAuthCompletion()),this.authState=e}decodeToken(e){try{return function(e,t){let r;if("string"!=typeof e)throw new InvalidTokenError("Invalid token specified: must be a string");t||(t={});let n=!0===t.header?0:1,i=e.split(".")[n];if("string"!=typeof i)throw new InvalidTokenError(`Invalid token specified: missing part #${n+1}`);try{r=function(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw Error("base64 string is not of the correct length")}try{var r;return r=t,decodeURIComponent(atob(r).replace(/(.)/g,(e,t)=>{let r=t.charCodeAt(0).toString(16).toUpperCase();return r.length<2&&(r="0"+r),"%"+r}))}catch(e){return atob(t)}}(i)}catch(e){throw new InvalidTokenError(`Invalid token specified: invalid base64 for part #${n+1} (${e.message})`)}try{return JSON.parse(r)}catch(e){throw new InvalidTokenError(`Invalid token specified: invalid json for part #${n+1} (${e.message})`)}}(e)}catch(e){return this._logVerbose(`Error decoding token: ${e instanceof Error?e.message:"Unknown error"}`),null}}_logVerbose(e){this.logger.logVerbose(`${e} [v${this.configVersion}]`)}};let L=["convexClientConstructed","convexWebSocketOpen","convexFirstMessageReceived"];function performanceMarkToJson(e){let t=e.name.slice(6);return{name:t=t.charAt(0).toLowerCase()+t.slice(1),startTime:e.startTime}}var V=Object.defineProperty,client_defNormalProp=(e,t,r)=>t in e?V(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,client_publicField=(e,t,r)=>client_defNormalProp(e,"symbol"!=typeof t?t+"":t,r);let client_BaseConvexClient=class client_BaseConvexClient{constructor(e,t,r){var n;let i;if(client_publicField(this,"address"),client_publicField(this,"state"),client_publicField(this,"requestManager"),client_publicField(this,"webSocketManager"),client_publicField(this,"authenticationManager"),client_publicField(this,"remoteQuerySet"),client_publicField(this,"optimisticQueryResults"),client_publicField(this,"_transitionHandlerCounter",0),client_publicField(this,"_nextRequestId"),client_publicField(this,"_onTransitionFns",new Map),client_publicField(this,"_sessionId"),client_publicField(this,"firstMessageReceived",!1),client_publicField(this,"debug"),client_publicField(this,"logger"),client_publicField(this,"maxObservedTimestamp"),client_publicField(this,"mark",e=>{if(this.debug){var t;t=this.sessionId,"undefined"!=typeof performance&&performance.mark&&performance.mark(e,{detail:{sessionId:t}})}}),"object"==typeof e)throw Error("Passing a ClientConfig object is no longer supported. Pass the URL of the Convex deployment as a string directly.");r?.skipConvexDeploymentUrlCheck!==!0&&function(e){if(void 0===e)throw Error("Client created with undefined deployment address. If you used an environment variable, check that it's set.");if("string"!=typeof e)throw Error(`Invalid deployment address: found ${e}".`);if(!(e.startsWith("http:")||e.startsWith("https:")))throw Error(`Invalid deployment address: Must start with "https://" or "http://". Found "${e}".`);try{new URL(e)}catch{throw Error(`Invalid deployment address: "${e}" is not a valid URL. If you believe this URL is correct, use the \`skipConvexDeploymentUrlCheck\` option to bypass this.`)}if(e.endsWith(".convex.site"))throw Error(`Invalid deployment address: "${e}" ends with .convex.site, which is used for HTTP Actions. Convex deployment URLs typically end with .convex.cloud? If you believe this URL is correct, use the \`skipConvexDeploymentUrlCheck\` option to bypass this.`)}(e),r={...r};let s=r.authRefreshTokenLeewaySeconds??2,o=r.webSocketConstructor;if(!o&&"undefined"==typeof WebSocket)throw Error("No WebSocket global variable defined! To use Convex in an environment without WebSocket try the HTTP client: https://docs.convex.dev/api/classes/browser.ConvexHttpClient");o=o||WebSocket,this.debug=r.reportDebugInfoToConvex??!1,this.address=e,this.logger=!1===r.logger?(n={verbose:r.verbose??!1},new Logger(n)):!0!==r.logger&&r.logger?r.logger:logging_instantiateDefaultLogger({verbose:r.verbose??!1});let a=e.search("://");if(-1===a)throw Error("Provided address was not an absolute URL.");let u=e.substring(a+3),c=e.substring(0,a);if("http"===c)i="ws";else if("https"===c)i="wss";else throw Error(`Unknown parent protocol ${c}`);let l=`${i}://${u}/api/${w}/sync`;this.state=new LocalSyncState,this.remoteQuerySet=new RemoteQuerySet(e=>this.state.queryPath(e),this.logger),this.requestManager=new RequestManager(this.logger),this.authenticationManager=new AuthenticationManager(this.state,{authenticate:e=>{let t=this.state.setAuth(e);return this.webSocketManager.sendMessage(t),t.baseVersion},stopSocket:()=>this.webSocketManager.stop(),tryRestartSocket:()=>this.webSocketManager.tryRestart(),pauseSocket:()=>{this.webSocketManager.pause(),this.state.pause()},resumeSocket:()=>this.webSocketManager.resume(),clearAuth:()=>{this.clearAuth()}},{logger:this.logger,refreshTokenLeewaySeconds:s}),this.optimisticQueryResults=new OptimisticQueryResults,this.addOnTransitionHandler(e=>{t(e.queries.map(e=>e.token))}),this._nextRequestId=0,this._sessionId="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{let t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)});let{unsavedChangesWarning:h}=r;if("undefined"==typeof window||void 0===window.addEventListener){if(!0===h)throw Error("unsavedChangesWarning requested, but window.addEventListener not found! Remove {unsavedChangesWarning: true} from Convex client options.")}else!1!==h&&window.addEventListener("beforeunload",e=>{if(this.requestManager.hasIncompleteRequests()){e.preventDefault();let t="Are you sure you want to leave? Your changes may not be saved.";return(e||window.event).returnValue=t,t}});this.webSocketManager=new WebSocketManager(l,{onOpen:e=>{this.mark("convexWebSocketOpen"),this.webSocketManager.sendMessage({...e,type:"Connect",sessionId:this._sessionId,maxObservedTimestamp:this.maxObservedTimestamp});let t=new Set(this.remoteQuerySet.remoteQueryResults().keys());this.remoteQuerySet=new RemoteQuerySet(e=>this.state.queryPath(e),this.logger);let[r,n]=this.state.restart(t);for(let e of(n&&this.webSocketManager.sendMessage(n),this.webSocketManager.sendMessage(r),this.requestManager.restart()))this.webSocketManager.sendMessage(e)},onResume:()=>{let[e,t]=this.state.resume();for(let r of(t&&this.webSocketManager.sendMessage(t),e&&this.webSocketManager.sendMessage(e),this.requestManager.resume()))this.webSocketManager.sendMessage(r)},onMessage:e=>{switch(this.firstMessageReceived||(this.firstMessageReceived=!0,this.mark("convexFirstMessageReceived"),this.reportMarks()),e.type){case"Transition":{this.observedTimestamp(e.endVersion.ts),this.authenticationManager.onTransition(e),this.remoteQuerySet.transition(e),this.state.transition(e);let t=this.requestManager.removeCompleted(this.remoteQuerySet.timestamp());this.notifyOnQueryResultChanges(t);break}case"MutationResponse":{e.success&&this.observedTimestamp(e.ts);let t=this.requestManager.onResponse(e);null!==t&&this.notifyOnQueryResultChanges(new Map([[t.requestId,t.result]]));break}case"ActionResponse":this.requestManager.onResponse(e);break;case"AuthError":this.authenticationManager.onAuthError(e);break;case"FatalError":{let t=function(e,t){let r=`[CONVEX FATAL ERROR] ${t}`;return e.error(r),Error(r)}(this.logger,e.error);throw this.webSocketManager.terminate(),t}}return{hasSyncedPastLastReconnect:this.hasSyncedPastLastReconnect()}}},o,this.logger),this.mark("convexClientConstructed")}hasSyncedPastLastReconnect(){let e=this.requestManager.hasSyncedPastLastReconnect()||this.state.hasSyncedPastLastReconnect();return e}observedTimestamp(e){(void 0===this.maxObservedTimestamp||this.maxObservedTimestamp.lessThanOrEqual(e))&&(this.maxObservedTimestamp=e)}getMaxObservedTimestamp(){return this.maxObservedTimestamp}notifyOnQueryResultChanges(e){let t=this.remoteQuerySet.remoteQueryResults(),r=new Map;for(let[e,n]of t){let t=this.state.queryToken(e);if(null!==t){let i={result:n,udfPath:this.state.queryPath(e),args:this.state.queryArgs(e)};r.set(t,i)}}let n=this.optimisticQueryResults.ingestQueryResultsFromServer(r,new Set(e.keys()));this.handleTransition({queries:n.map(e=>({token:e,modification:{kind:"Updated",result:r.get(e).result}})),reflectedMutations:Array.from(e).map(([e,t])=>({requestId:e,result:t})),timestamp:this.remoteQuerySet.timestamp()})}handleTransition(e){for(let t of this._onTransitionFns.values())t(e)}addOnTransitionHandler(e){let t=this._transitionHandlerCounter++;return this._onTransitionFns.set(t,e),()=>this._onTransitionFns.delete(t)}setAuth(e,t){this.authenticationManager.setConfig(e,t)}hasAuth(){return this.state.hasAuth()}setAdminAuth(e,t){let r=this.state.setAdminAuth(e,t);this.webSocketManager.sendMessage(r)}clearAuth(){let e=this.state.clearAuth();this.webSocketManager.sendMessage(e)}subscribe(e,t,r){let n=common_parseArgs(t),{modification:i,queryToken:s,unsubscribe:o}=this.state.subscribe(e,n,r?.journal,r?.componentPath);return null!==i&&this.webSocketManager.sendMessage(i),{queryToken:s,unsubscribe:()=>{let e=o();e&&this.webSocketManager.sendMessage(e)}}}localQueryResult(e,t){let r=common_parseArgs(t),n=serializePathAndArgs(e,r);return this.optimisticQueryResults.queryResult(n)}localQueryResultByToken(e){return this.optimisticQueryResults.queryResult(e)}hasLocalQueryResultByToken(e){return this.optimisticQueryResults.hasQueryResult(e)}localQueryLogs(e,t){let r=common_parseArgs(t),n=serializePathAndArgs(e,r);return this.optimisticQueryResults.queryLogs(n)}queryJournal(e,t){let r=common_parseArgs(t),n=serializePathAndArgs(e,r);return this.state.queryJournal(n)}connectionState(){let e=this.webSocketManager.connectionState();return{hasInflightRequests:this.requestManager.hasInflightRequests(),isWebSocketConnected:e.isConnected,hasEverConnected:e.hasEverConnected,connectionCount:e.connectionCount,connectionRetries:e.connectionRetries,timeOfOldestInflightRequest:this.requestManager.timeOfOldestInflightRequest(),inflightMutations:this.requestManager.inflightMutations(),inflightActions:this.requestManager.inflightActions()}}async mutation(e,t,r){let n=await this.mutationInternal(e,t,r);if(!n.success){if(void 0!==n.errorData)throw forwardData(n,new errors_ConvexError(createHybridErrorStacktrace("mutation",e,n)));throw Error(createHybridErrorStacktrace("mutation",e,n))}return n.value}async mutationInternal(e,t,r,n){let{mutationPromise:i}=this.enqueueMutation(e,t,r,n);return i}enqueueMutation(e,t,r,n){let i=common_parseArgs(t);this.tryReportLongDisconnect();let s=this.nextRequestId;if(this._nextRequestId++,void 0!==r){let e=r.optimisticUpdate;if(void 0!==e){let t=this.optimisticQueryResults.applyOptimisticUpdate(t=>{e(t,i)},s),r=t.map(e=>{let t=this.localQueryResultByToken(e);return{token:e,modification:{kind:"Updated",result:void 0===t?void 0:{success:!0,value:t,logLines:[]}}}});this.handleTransition({queries:r,reflectedMutations:[],timestamp:this.remoteQuerySet.timestamp()})}}let o={type:"Mutation",requestId:s,udfPath:e,componentPath:n,args:[value_convexToJson(i)]},a=this.webSocketManager.sendMessage(o),u=this.requestManager.request(o,a);return{requestId:s,mutationPromise:u}}async action(e,t){let r=await this.actionInternal(e,t);if(!r.success){if(void 0!==r.errorData)throw forwardData(r,new errors_ConvexError(createHybridErrorStacktrace("action",e,r)));throw Error(createHybridErrorStacktrace("action",e,r))}return r.value}async actionInternal(e,t,r){let n=common_parseArgs(t),i=this.nextRequestId;this._nextRequestId++,this.tryReportLongDisconnect();let s={type:"Action",requestId:i,udfPath:e,componentPath:r,args:[value_convexToJson(n)]},o=this.webSocketManager.sendMessage(s);return this.requestManager.request(s,o)}async close(){return this.authenticationManager.stop(),this.webSocketManager.terminate()}get url(){return this.address}get nextRequestId(){return this._nextRequestId}get sessionId(){return this._sessionId}reportMarks(){if(this.debug){let e=function(e){if("undefined"==typeof performance||!performance.getEntriesByName)return[];let t=[];for(let r of L){let n=performance.getEntriesByName(r).filter(e=>"mark"===e.entryType).filter(t=>t.detail.sessionId===e);t.push(...n)}return t.map(performanceMarkToJson)}(this.sessionId);this.webSocketManager.sendMessage({type:"Event",eventType:"ClientConnect",event:e})}}tryReportLongDisconnect(){if(!this.debug)return;let e=this.connectionState().timeOfOldestInflightRequest;if(null===e||Date.now()-e.getTime()<=6e4)return;let t=`${this.address}/api/debug_event`;fetch(t,{method:"POST",headers:{"Content-Type":"application/json","Convex-Client":`npm-${w}`},body:JSON.stringify({event:"LongWebsocketDisconnect"})}).then(e=>{e.ok||this.logger.warn("Analytics request failed with response:",e.body)}).catch(e=>{this.logger.warn("Analytics response failed with error:",e)})}};var P=Object.defineProperty,react_client_defNormalProp=(e,t,r)=>t in e?P(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,react_client_publicField=(e,t,r)=>react_client_defNormalProp(e,"symbol"!=typeof t?t+"":t,r);if(void 0===s)throw Error("Required dependency 'react' not found");let ConvexReactClient=class ConvexReactClient{constructor(e,t){var r;if(react_client_publicField(this,"address"),react_client_publicField(this,"cachedSync"),react_client_publicField(this,"listeners"),react_client_publicField(this,"options"),react_client_publicField(this,"closed",!1),react_client_publicField(this,"_logger"),react_client_publicField(this,"adminAuth"),react_client_publicField(this,"fakeUserIdentity"),void 0===e)throw Error("No address provided to ConvexReactClient.\nIf trying to deploy to production, make sure to follow all the instructions found at https://docs.convex.dev/production/hosting/\nIf running locally, make sure to run `convex dev` and ensure the .env.local file is populated.");if("string"!=typeof e)throw Error(`ConvexReactClient requires a URL like 'https://happy-otter-123.convex.cloud', received something of type ${typeof e} instead.`);if(!e.includes("://"))throw Error("Provided address was not an absolute URL.");this.address=e,this.listeners=new Map,this._logger=t?.logger===!1?(r={verbose:t?.verbose??!1},new Logger(r)):t?.logger!==!0&&t?.logger?t.logger:logging_instantiateDefaultLogger({verbose:t?.verbose??!1}),this.options={...t,logger:this._logger}}get sync(){if(this.closed)throw Error("ConvexReactClient has already been closed.");return this.cachedSync||(this.cachedSync=new client_BaseConvexClient(this.address,e=>this.transition(e),this.options),this.adminAuth&&this.cachedSync.setAdminAuth(this.adminAuth,this.fakeUserIdentity)),this.cachedSync}setAuth(e,t){if("string"==typeof e)throw Error("Passing a string to ConvexReactClient.setAuth is no longer supported, please upgrade to passing in an async function to handle reauthentication.");this.sync.setAuth(e,t??(()=>{}))}clearAuth(){this.sync.clearAuth()}setAdminAuth(e,t){if(this.adminAuth=e,this.fakeUserIdentity=t,this.closed)throw Error("ConvexReactClient has already been closed.");this.cachedSync&&this.sync.setAdminAuth(e,t)}watchQuery(e,...t){let[r,n]=t,i=api_getFunctionName(e);return{onUpdate:e=>{let{queryToken:t,unsubscribe:s}=this.sync.subscribe(i,r,n),o=this.listeners.get(t);return void 0!==o?o.add(e):this.listeners.set(t,new Set([e])),()=>{if(this.closed)return;let r=this.listeners.get(t);r.delete(e),0===r.size&&this.listeners.delete(t),s()}},localQueryResult:()=>{if(this.cachedSync)return this.cachedSync.localQueryResult(i,r)},localQueryLogs:()=>{if(this.cachedSync)return this.cachedSync.localQueryLogs(i,r)},journal:()=>{if(this.cachedSync)return this.cachedSync.queryJournal(i,r)}}}mutation(e,...t){let[r,n]=t,i=api_getFunctionName(e);return this.sync.mutation(i,r,n)}action(e,...t){let r=api_getFunctionName(e);return this.sync.action(r,...t)}query(e,...t){let r=this.watchQuery(e,...t),n=r.localQueryResult();return void 0!==n?Promise.resolve(n):new Promise((e,t)=>{let n=r.onUpdate(()=>{n();try{e(r.localQueryResult())}catch(e){t(e)}})})}connectionState(){return this.sync.connectionState()}get logger(){return this._logger}async close(){if(this.closed=!0,this.listeners=new Map,this.cachedSync){let e=this.cachedSync;this.cachedSync=void 0,await e.close()}}transition(e){for(let t of e){let e=this.listeners.get(t);if(e)for(let t of e)t()}}};let Q=s.createContext(void 0),client_ConvexProvider=({client:e,children:t})=>s.createElement(Q.Provider,{value:e},t);(0,s.createContext)(void 0)}},function(e){var __webpack_exec__=function(t){return e(e.s=t)};e.O(0,[774,179],function(){return __webpack_exec__(1118),__webpack_exec__(9974)}),_N_E=e.O()}]);